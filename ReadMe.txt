

2018.7.26
	实现简单的任务调度，去掉了ucos中其他代码，只留下了任务调度功能
	自己写了任务初始化，任务结构体，优先级管理，带任务调度的系统延时等
	使用双堆栈
	使用stm32f103
2018.7.31
	使用任务调度重写集中器程序
	使用多条协议
	集中器上记录了设备的类型和状态，
	按键使用了定时器4，
2018.8.1
	可以和上位机通信，优化网口内存占用，可以在C8T6上运行
2018.8.2
	重写了设备控制逻辑，一旦有设备控制成功即改变集中器的状态指示
		无论是手动控制还是自动控制，
	加入了自动控制，每30秒检测一次环境值与设定值得差异，超出限制就启动控制
	加入手动自动的转换
	加入消息检测函数，如果网口有消息没有读取（处于断线重连中），就不再向网口发送消息，以免阻塞消息通路
2018.8.15
	加入配置项
2018.8.16
	程序功能全部实现
	设备为开启状态才会给上位机发送消息
	设备连续5次查询超时才会被确认为离线状态
	手动操作设备失败会执行10次尝试，
	使用新的无线通信协议
	集中器会记录设备的状态，设备操作成功集中器上的指示灯状态才会变
2018.8.17
	修复串口屏显示湿度值错误的问题
	修复集中器地址为0时，控制器只能开不能关的问题
	修改MAC地址，解决网络丢包的问题
	解决手动控制时无线接收函数的数组越界问题
2018.8.18
	修复无线的FLASH存储地址和LCD存储地址重复所导致的设备地址在LCD屏幕设置之后会改变的问题
2018.9.12
	更改为IAP程序
2018.9.14
	加入空闲中断，提高命令接收成功率
2018.9.15
	更改flash写入算法，适应不同块大小的flash
	集中器可以通过配置软件进入配置模式
	加入软件版本查询
2018.9.17
	修复软件编译时间显示不全的问题
	进入硬件中断之后自动重启
	去除不是配置模式仍然可以进行配置的BUG
	加入重启命令
2018.9.21
	兼容R8与RC芯片的程序，改了一半，注释了灯光任务
	内存分配可以自适应不同的芯片型号，系统内核使用10kb的内存，剩余的内存全部用来做内存分配
2018.9.30
	添加恒湿机
2018.10.8
	替换malloc.h文件，解决在R8T6型号上初始化内存失败的BUG
	设备初始化为离线状态
	控制时首先判断离线，提高控制速度
2018.10.9
	融合了beep，文件系统
	替换my_key.c文件，长按K3播放一首音乐，长按K1开启与关闭自动控制任务，长按K2控制灯带
	长按K2灯带熄灭为自动模式，灯带旋转为手动模式，进入手动页面时显示最新的手动自动状态
2018.10.11
	自定义数字转字符函数，解决json温湿度输出始终为0的bug
2018.10.12
	添加进入退出配置模式函数，
	添加信道转换函数，没有使用
2018.10.16
	申请足够的内存，解决蜂鸣器音乐播放异常的BUG
2018.11.5
	更改集中器适应新版的板子
	解决在屏幕上关屏幕，在屏幕上不能再开的bug
2018.11.6
	新板子添加触摸按键
	优化屏幕睡眠控制逻辑，只在0~7秒内生效
	可以设置省电模式区间，屏幕会在区间起始处关，在终止处开，省电模式开关有效
	手动模式状态可以掉电保存
2018.11.15
	解决在设备数量较多时网口数据上传间隔过长的问题
	整理代码，合理安排驱动层和应用层的代码分配
2018.11.16
	操作系统部分分层清晰，分为CPU层，操作系统核心层，任务层
	单片机部分分为单片机内核层，硬件驱动层，
	合理定义消息函数，使其更易于编程
	重新规划程序逻辑，使其更合理，更清晰
	定义一个配置描述文件，文件名为wk_config.txt，
	拟实现温控的配置参数可以通过SD卡来配置，文件配置语法见“温控配置文件描述”文件
2018.11.17
	处理自动控制恒湿机时恒湿机的湿度为1或2的bug
2018.11.19
	拟实现温控的配置参数可以通过SD卡来配置，用json文件，配置语法见“温控配置文件描述”文件
2018.11.23
	加入新版环绕灯PWM调光
2018.12.3
	将新版上位机协议加入进来，新板子只支持第二种协议
	加入第二种协议需要修改的地方如下：
		串口屏设置参数的时候向上位机报告修改后的值
		环境值检测到超标时向上位机报告超标信息
		设备返回值附带了漏水报警向上位机报告漏水报警
	测试结果：
		串口屏修改参数后会上传修改后的数据，为了保证数据上传成功，多点几次确定
		环境值超标报警正常
		漏水报警正常
		上位机设置环境上下限正常
		上位机设置手动自动模式正常
		上位机控制设备正常
	解决网络端口没有连接上时ping不通的bug
	加入端口1，udp连接，用来发送调试信息等，测试成功
2018.12.4
	受FLASH影响，把配置信息存储位置设置到(0x8040000-1024),因此此程序能用于RC型号的芯片
	加入调试信息，网口端口1,使用UDP模式与网络中端口7000通信，上电时集中器会主动发送一次本机参数
2018.12.5
	重新做存储空间分配，文件系统位置改到(0x8040000-1024*16)
2018.12.7
	加入DHCP成功，重新组织网络部分代码
2018.12.8
	与服务器断线后可以快速重连
	如果没有配置本机ip地址，系统自动向网关获取动态的IP地址
	在每次重连成功之后发送设备上线消息
2018.12.8
	重新组织与上位机的消息交互代码，规范通信协议上位机协议再次更新
	自适应调试主机的IP地址和端口，当调试主机收不到集中器的消息时只需要向255.255.255.255:12地址发送任意消息
2018.12.9
	实时任务调度
2018.12.10
	实现了自动获取服务器地址
	解决了在实时任务调度时可能是由于数据发送时间过快导致的网口消息发送不全的问题，
	解决方式是在发送数据的后面加入一个500us的阻塞延时
2018.12.13
	添加了DNS，修改自动获取服务器地址时错误的操作，修改彩灯缓冲为一个灯
2018.12.14
	与上位机的数据交换协议改为新版
2018.12.15
	实现连接到百度云并可以更新数据
2018.12.21
	由消息阻塞导致的不发送上位机消息的BUG
	在滴答定时器中判断是否一直在不可调度状态，超过一秒就强行解除，此为下下策，最好永远不要运行到那里去
	不可调度函数加入任务记录，记录进入不可调度状态的任务
	添加json字符串有消息判断，不完整的json字符串不解析
	任务结构体添加任务挂起标志，修改任务挂起函数
	网络接收数据发送数据等函数加入不可调度临界区
	网口发送和接收函数添加微妙级延时，防止数据发送不完整
2019.1.16
	解决自动获取服务器IP地址和端口失败的bug
2019.1.18
	与上位机通信相关bug处理。
	添加新的环绕灯调光
	rf控制和传输逻辑与V2.3版本相同
	通过网口设置无限信道
	使用定时器3的硬件PWM调光
2019.1.19
	环绕灯可以渐变调光，
	按键按下时长越长环绕灯越亮
	任务调度进行优化修改，解决任务挂起无效，延时函数无效的问题
2019.1.21
	自动控制加了一个超调量，自动关闭设备的条件是环境参数超过了超调量
2019.2.12
	返回主机端口号{"cmd":"serverconf","data":{"serverport":6000}}
	空闲任务里统计意外死亡的任务并进行唤醒，通过网口调试可以查询
2019.2.14
	兼容石柱版本电路板，旧版串口屏，开机时进入主页面，睡眠按键可用
	使用了定时器2来播放蜂鸣器音乐，定时器3用来调光，定时器4用作按键扫描和运行时间统计
2019.2.27 
	加入ping命令，解决debug中使用getip命令时造成内存泄漏的问题
2019.2.28
	解决给上位机返回没有降状态的bug 
2019.2.28
	重建集中器工程，进行代码规范，首次编译成功
2019.3.1
	重新组织代码，消除大多数可以消除的警告，编译通过
	系统运行时间计数改为在滴答定时器中进行
	解决集中器ping操作之后其他主机不能ping集中器的bug
	定义动态定时器中断服务函数有10ms和10us两种
2019.3.2
	10us的定时器中断服务函数只能添加一个，因为太多会产生太久的占用时间，影响下次中断。
	可以通过udp debug来设置集中器的一些参数，具体参数输入set来获取。
2019.3.4
	添加通过网络升级程序相关函数
2019.3.7
	完成网络升级功能的添加并测试成功
	sysinfo命令显示添加IAP程序的版本信息
	可以通过设置命令来临时更改调试端口，在局域网中有多个集中器时可以防止IAP升级时的干扰
2019.3.16
	添加了4个dbg命令，设置集中器地址；添加设备；移除设备；清空已配置设备
2019.3.18
	解决集中器按键短按无效的bug，去掉按键驱动以前无用的代码
	添加了设置自动控制频率，自动控制超调量的debug项
	添加设置集中器名称的debug项
	根据设备SN码默认一个设备名称为WK_JZQ-xxxx
2019.3.19
	默认自动控制超调量为4，默认控制频率为30秒
2019.3.20
	增加一个参数，温控报警容差，整理自动控制部分程序结构
	解决了串口屏通信数据概率性丢失的问题，实测还是有小概率数据丢失
2019.3.25
	加入NTP，RTC，看门狗，网口自动重启
2019.3.26
	在程序更新死循环中加入喂狗，加入查询命令 输入"whos"可查询集中器编号所对应的IP地址
	在连续连接网关失败五次后会重新申请IP地址
	获取IP地址成功会发送本机编号和IP地址
	解决了经常自动重新获取IP地址的bug
2019.3.27
	解决没有设备的时候死机的bug
	更改串口，网口的中断处理在任务0中，修改等待消息逻辑，使其可以给自己发送消息
	增加顶层消息分发任务，去除按键任务，把复杂的中断处理代码移到任务0中来，减少中断占用的处理器时间
	把无线相关的任务合并为1个
	打开网口所有端口的中断，网络任务使用了其中3个
2019.3.28
	解决dbg命令 移除设备 无效的bug
	系统配置加载在任务0中进行
	重写屏幕背光控制逻辑
2019.3.29
	解决了网口上传环境数据为0的bug
	所有任务栈8字节对齐
	使用sprintf函数做浮点数到字符串的转换
	采集器 传感器加入PM2.5，CO2
	增加采集器故障报警
2019.3.30
	解决自动控制的参考环境值不更新的bug
	解决设备添加一体机时实际添加为空调的bug
	采集器传感器数据更改为浮点型，此日期之后的集中器与之前的采集器不兼容
	发现概率性不返回调试信息的bug
	系统消息传递丢失导致中断触发后没有进入中断处理函数，网口的中断失效
2019.4.1
	按键驱动中加入按键设置函数，用于设置虚拟按键
	加入虚拟按键调试命令
	滴答定时器中去除cpu独占判断，因为有看门狗，发生cpu独占之后会被看门狗复位
2019.4.2
	解决写内部flash的时候造成CPU独占的bug，
	成功使用内部flash进行IAP升级
	加入sleep函数，强制睡眠，在睡眠结束之前不能被唤醒
	每5秒给端口7020,7030广播传感器信息
	在进入不可调度临界区内不要调用会造成任务切换的函数，比如delay_ms，否则会停留在空闲任务程序死掉
2019.4.3
	加入任务栈使用情况统计，dbg命令为：task getusege
2019.4.10
	兼容以前的温控采集器
	去除iap升级时数据包大小限制
	加入多版本支持，通过不同工程编译适配不同电路板的程序
	解决lcd温度上下限不能设置的bug
2019.4.13
	串口屏区号处显示和设置本机名称
	发现有一个板子灯光乱闪，一个板子多次点击之后按键失灵
2019.4.16
	加入内存读写支持
	加入自定义函数运行支持，函数参数最多为4个，目前测试传入整形参数执行正常
	函数支持整形参数和字符串型参数，测试字符串类型有小bug，功能正常
2019.4.18
	修复自定义函数运行相关bug
2019.4.19
	加入{"cmd":"ping"}命令，上位机发送这个命令集中器会回应
2019.4.20
	加入函数对照表，可以直接输入函数名进行函数调用，参数增加函数类型
2019.4.22
	加入脚本运行支持，顺序执行数字变量运算成功
	可以定义变量，在函数中使用变量，变量只支持整形
	



